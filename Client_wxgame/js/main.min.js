var egret=window.egret,__reflect=this&&this.__reflect||function(e,t,i){e.__class__=t,i?i.push(t):i=[t],e.__types__=e.__types__?i.concat(e.__types__):i},__extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);i.prototype=t.prototype,e.prototype=new i},__awaiter=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))(function(r,l){function o(e){try{s(n.next(e))}catch(t){l(t)}}function a(e){try{s(n["throw"](e))}catch(t){l(t)}}function s(e){e.done?r(e.value):new i(function(t){t(e.value)}).then(o,a)}s((n=n.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function i(e){return function(t){return n([e,t])}}function n(i){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,l&&(o=l[2&i[0]?"return":i[0]?"throw":"next"])&&!(o=o.call(l,i[1])).done)return o;switch(l=0,o&&(i=[0,o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,l=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(o=s.trys,!(o=o.length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(n){i=[6,n],l=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var r,l,o,a,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},GameControl=function(e){function t(t,i,n){var r=e.call(this)||this;return r.maskLight=new LightMask,r.lightBitMap=new egret.Bitmap,r.img_role=t,r.group_light=i,r.InitLight(),r.speed=n,r.img_role.anchorOffsetX=r.img_role.width/2,r.img_role.anchorOffsetY=r.img_role.height/2,r}return __extends(t,e),t.prototype.InitLight=function(){var e=this.maskLight,t=this.group_light;e.setMaskSize(t.width,t.height),e.setLightValue(200),this.DrawLightTexture(),t.addChild(this.lightBitMap),e.x=0,e.y=0},t.prototype.DrawLightTexture=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){return e=new egret.RenderTexture,e.drawToTexture(this.maskLight),this.lightBitMap.texture=e,[2]})})},t.prototype.RefreshLight=function(){if(!(egret.getTimer()-this.lightRefreshTime<50)){var e=this.img_role;this.maskLight.setLightPos(e.x-e.width/2,e.y-e.height/2),this.DrawLightTexture(),this.lightRefreshTime=egret.getTimer()}},t.prototype.RoleMoveState=function(e,t,i){switch(void 0===t&&(t=0),void 0===i&&(i=0),e){case 0:this.addEventListener(egret.Event.ENTER_FRAME,this.PlayerMove,this);break;case 1:this.removeEventListener(egret.Event.ENTER_FRAME,this.PlayerMove,this);break;case 2:this.addEventListener(egret.Event.ENTER_FRAME,this.RoleAutoMove,this);break;case 3:this.RoleAutoMove()}},t.prototype.RoleAutoMove=function(){var e=GameUI.manageCells.returnPath;if(0!=e.length){var t;t=e.length>1?e[e.length-2]+.5:e[0]+.5,this.direction=Math.atan2(t*WallRender.height-this.img_role.y,t*WallRender.width-this.img_role.x),this.RoleMove(2)}},t.prototype.PlayerMove=function(){this.RoleMove(1)},t.prototype.RoleMove=function(e){if(void 0===e&&(e=1),null!=this.direction){var t=(egret.getTimer(),Number((Math.cos(this.direction)*this.speed*e).toFixed(2))),i=Number((Math.sin(this.direction)*this.speed*e).toFixed(2)),n=GameUI.manageCells.currentCell,r=GameUI.manageRenders.currentRender,l=0,o=this.img_role,a=t>0,s=a?n.rightWall:n.leftWall;if(!s.isOpen||this.IsEdge(0)){var h=.5*WallRender.vWallwidth+.5*o.width,c=Math.abs(r.x+(a?1:0)*r.width/e-o.x)-h;l=a?Math.min(c,t):Math.max(-c,t)}else l=t;if(o.x+=l,a=0>i,s=a?n.upWall:n.downWall,!s.isOpen||this.IsEdge(1)){var u=.5*WallRender.hWallHeight+.5*o.height,c=Math.abs(r.y+(a?0:1)*r.height/e-o.y)-u;l=a?Math.max(-c,i):Math.min(c,i)}else l=i;o.y+=l,this.dispatchEventWith(MyEvent.moveScroll,!1,{x:o.x,speed:t}),GameUI.manageCells.SetIndex(o.x,o.y),this.RefreshLight()}},t.prototype.IsEdge=function(e){var t=!0,i=this.img_role,n=GameUI.manageRenders.currentRender;switch(e){case 0:t=Math.abs(i.y-n.y)<i.height/2+.5*WallRender.hWallHeight,t=t||Math.abs(i.y-n.y-n.height)<i.height/2+.5*WallRender.hWallHeight;break;case 1:t=Math.abs(i.x-n.x)<i.width/2+.5*WallRender.vWallwidth,t=t||Math.abs(i.x-n.x-n.width)<i.width/2+.5*WallRender.vWallwidth}return t},t}(eui.Component);__reflect(GameControl.prototype,"GameControl",["eui.UIComponent","egret.DisplayObject"]);var AssetAdapter=function(){function e(){}return e.prototype.getAsset=function(e,t,i){function n(n){t.call(i,n,e)}if(RES.hasRes(e)){var r=RES.getRes(e);r?n(r):RES.getResAsync(e,n,this)}else RES.getResByUrl(e,n,this,RES.ResourceItem.TYPE_IMAGE)},e}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var Main=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(e){}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()};var t=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",t),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.runGame()["catch"](function(e){console.log(e)})},t.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return[4,this.loadResource()];case 1:return t.sent(),this.createGameScene(),[4,platform.login()];case 2:return t.sent(),[4,platform.getUserInfo()];case 3:return e=t.sent(),console.log(e),[2]}})})},t.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(i){switch(i.label){case 0:return i.trys.push([0,5,,6]),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return i.sent(),[4,RES.loadGroup("loading")];case 2:return i.sent(),[4,this.loadTheme()];case 3:return i.sent(),e=new LoadingUI,this.stage.addChild(e),[4,RES.loadGroup("preload",0,e)];case 4:return i.sent(),Config.GetInstance().InitCofing(),this.stage.removeChild(e),[3,6];case 5:return t=i.sent(),console.error(t),[3,6];case 6:return[2]}})})},t.prototype.loadTheme=function(){var e=this;return new Promise(function(t,i){var n=new eui.Theme("resource/default.thm.json",e.stage);n.addEventListener(eui.UIEvent.COMPLETE,function(){t()},e)})},t.prototype.createGameScene=function(){var e=new GameUI;this.stage.addChild(e),wx.cloud.init()},t}(eui.UILayer);__reflect(Main.prototype,"Main");var DebugPlatform=function(){function e(){}return e.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,{nickName:"username"}]})})},e.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},e}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var ThemeAdapter=function(){function e(){}return e.prototype.getTheme=function(e,t,i,n){function r(e){t.call(n,e)}function l(t){t.resItem.url==e&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,l,null),i.call(n))}var o=this;if("undefined"!=typeof generateEUI)egret.callLater(function(){t.call(n,generateEUI)},this);else if("undefined"!=typeof generateEUI2)RES.getResByUrl("resource/gameEui.json",function(e,i){window.JSONParseClass.setData(e),egret.callLater(function(){t.call(n,generateEUI2)},o)},this,RES.ResourceItem.TYPE_JSON);else if("undefined"!=typeof generateJSON)if(e.indexOf(".exml")>-1){var a=e.split("/");a.pop();var s=a.join("/")+"_EUI.json";generateJSON.paths[e]?egret.callLater(function(){t.call(n,generateJSON.paths[e])},this):RES.getResByUrl(s,function(i){window.JSONParseClass.setData(i),egret.callLater(function(){t.call(n,generateJSON.paths[e])},o)},this,RES.ResourceItem.TYPE_JSON)}else egret.callLater(function(){t.call(n,generateJSON)},this);else RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,l,null),RES.getResByUrl(e,r,this,RES.ResourceItem.TYPE_TEXT)},e}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var Common=function(){function e(){}return e.getRandomInt=function(e,t){var i=t-e,n=Math.random();return e+Math.round(n*i)},e.ParseField=function(e,t,i){void 0===t&&(t=","),void 0===i&&(i=!0);var n=e.split(t);if(i){var r=[];return n.forEach(function(e){r.push(Number(e))}),r}return n},e.SaveData=function(e,t){var i;wx.cloud.callFunction({name:"addLog",data:{},success:function(e){i=e.OPENID},fail:function(e){console.log("err",e)}});var n,r=wx.cloud.database(),l=r.collection(e).where({_openid:i});l.count().then(function(i){0==i.total?r.collection(e).add({data:t,success:function(e){console.log("添加成功",e)}}):l.get().then(function(i){n=i.data[0]._id,r.collection(e).doc(n).update({data:t,success:function(e){console.log("更新成功",e)}})})})},e.LoadData=function(e){var t=wx.cloud.database();t.collection(e).get().then(function(e){return console.log("获取数据",e.data),e.data})},e}();__reflect(Common.prototype,"Common");var Config=function(){function e(){this.config_paths=[["configs_item","item_json"],["configs_map","map_json"]]}return e.GetInstance=function(){return e.instance=e.instance?e.instance:new e,e.instance},e.prototype.InitCofing=function(){var t=this;this.config_paths.forEach(function(i){e.instance[i[0]]=t.GetConfigFromFile(i[1])})},e.prototype.GetConfigFromFile=function(e){var t=RES.getRes(e),i=[];return t.forEach(function(e){i[e.id]=e}),i},e}();__reflect(Config.prototype,"Config");var ItemUI=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.partAdded=function(t,i){e.prototype.partAdded.call(this,t,i)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t}(eui.Component);__reflect(ItemUI.prototype,"ItemUI",["eui.UIComponent","egret.DisplayObject"]);var ItemLib=function(){function e(){}return e}();__reflect(ItemLib.prototype,"ItemLib");var MapLib=function(){function e(){}return e}();__reflect(MapLib.prototype,"MapLib");var Cell=function(){function e(){this.upWall=new Wall,this.downWall=new Wall,this.leftWall=new Wall,this.rightWall=new Wall,this.walls=[],this.upCell=null,this.downCell=null,this.leftCell=null,this.rightCell=null,this.nearCells=[],this.isSigned=!1,this.isPassed=!1,this.item=0}return e}();__reflect(Cell.prototype,"Cell");var CellBgRender=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t.prototype.dataChanged=function(){var e=this.data;if(0!=e.item){var t=Config.GetInstance().configs_item[e.item];this.img_exitSign.source=t.pic}else e.isSpecial?(this.img_exitSign.source=RES.getRes("532_png"),egret.log("特殊地面ID--->"+e.id)):this.img_exitSign.visible=!1;0==e.id?this.visible=!0:this.visible=!1,null==e.downCell&&null==e.rightCell&&(this.visible=!0,this.img_bg.visible=!1,this.img_exitSign.source=RES.getRes("100_png"))},t.prototype.LightenUp=function(){this.visible=!0},t.prototype.SetReturnSign=function(){},t.prototype.HideReturnSign=function(){this.img_exitSign.visible=!1},t.prototype.StartAni=function(){},t}(eui.ItemRenderer);__reflect(CellBgRender.prototype,"CellBgRender");var LoadingUI=function(e){function t(){var t=e.call(this)||this;return t.skinName="Loading",t}return __extends(t,e),t.prototype.onProgress=function(e,t){},t}(eui.Component);__reflect(LoadingUI.prototype,"LoadingUI",["eui.UIComponent","egret.DisplayObject"]);var GameItem=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.Init()},t.prototype.Init=function(){this.list.itemRenderer,this.list.dataProvider},t}(eui.Component);__reflect(GameItem.prototype,"GameItem",["eui.UIComponent","egret.DisplayObject"]);var ItemRenderInGameUI=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.dataChanged=function(){},t}(eui.ItemRenderer);__reflect(ItemRenderInGameUI.prototype,"ItemRenderInGameUI");var GameUI=function(e){function t(){var t=e.call(this)||this;return t.mapTexture=new egret.Bitmap,t.stepNum=0,t.virt=new VirtualRocker,t.once(egret.Event.REMOVED_FROM_STAGE,t.RemoveListener,t),t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.addChild(this.virt),this.virt.visible=!1,this.scroller.horizontalScrollBar.autoVisibility=!1,this.scroller.horizontalScrollBar.visible=!1,this.GenMiGong(),this.AddListener(),egret.log("childrenCreated")},t.prototype.InitManageRenders=function(e){t.manageRenders=new ManageRenders(this.list_wall,this.list_cell),t.manageRenders.InitRenders(e)},t.prototype.AddListener=function(){this.btn_return.addEventListener(egret.TouchEvent.TOUCH_TAP,this.ReturnSignCell,this),this.btn_test.addEventListener(egret.TouchEvent.TOUCH_TAP,this.TestDb,this),this.img_Bg.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.BeginTouch,this),this.img_Bg.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.Move,this),this.img_Bg.addEventListener(egret.TouchEvent.TOUCH_END,this.CancelTouch,this),this.img_Bg.addEventListener(egret.TouchEvent.TOUCH_CANCEL,this.CancelTouch,this),t.manageCells.addEventListener("RefreshCurRender",this.UpdateIndex,this),this.gameControl.addEventListener(MyEvent.moveScroll,this.MoveScroll,this)},t.prototype.TestDb=function(){ItemManage.GetInstance().GetItem(Common.getRandomInt(1,3),1)},t.prototype.ReturnSignCell=function(){this.gameControl.RoleMoveState(2)},t.prototype.MoveScroll=function(e){var t=this.scroller.viewport.scrollH,i=e.data;if(i.speed<0)i.x-t<this.scroller.width/2&&t>0&&(this.scroller.viewport.scrollH+=Math.max(i.speed,-t));else{var n=this.scroller.viewport.measuredWidth;i.x-t>this.scroller.width/2&&t+this.scroller.width<n&&(this.scroller.viewport.scrollH+=Math.min(i.speed,n-t-this.scroller.width))}},t.prototype.UpdateIndex=function(e){this.stepNum++,this.txt_stepNum.text="已探索："+this.stepNum.toString()},t.prototype.RemoveListener=function(){this.btn_return.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.TestDb,this),this.btn_test.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.TestDb,this),this.img_Bg.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.BeginTouch,this),this.img_Bg.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.Move,this),this.img_Bg.removeEventListener(egret.TouchEvent.TOUCH_END,this.CancelTouch,this),this.img_Bg.removeEventListener(egret.TouchEvent.TOUCH_CANCEL,this.CancelTouch,this)},t.prototype.Move=function(e){var t=this.virt.onTouchMove(e);this.gameControl.direction=t},t.prototype.CancelTouch=function(){this.gameControl&&(this.gameControl.direction=null,this.gameControl.RoleMoveState(1),this.virt.stop())},t.prototype.BeginTouch=function(e){this.gameControl&&(this.virt.x=e.stageX,this.virt.y=e.stageY,this.virt.start(),this.gameControl.RoleMoveState(0))},t.prototype.GenMiGong=function(){var e=this;e.txt_stepNum.text="已探索：0",t.manageCells=new ManageCells(GenCells.GetCells()),e.InitManageRenders(t.manageCells.cells),e.InitMask(),e.gameControl=new GameControl(this.img_role,this.group_light,10),e.PlayStartAni(),egret.log("迷宫生成完成")},t.prototype.InitMask=function(){var e=this;e.group_wallBg.width=e.list_wall.width,e.img_mask.x=WallRender.vWallwidth,e.img_mask.y=WallRender.hWallHeight,e.img_mask.width=e.list_wall.width-2*WallRender.vWallwidth,e.img_mask.height=e.list_wall.height-2*WallRender.hWallHeight,e.group_light.x=WallRender.vWallwidth,e.group_light.y=WallRender.hWallHeight,e.group_light.width=e.list_wall.width-2*WallRender.vWallwidth,e.group_light.height=e.list_wall.height-2*WallRender.hWallHeight},t.prototype.PlayStartAni=function(){var e=this,i=t.manageRenders.currentRender;this.img_role.x=i.x,this.img_role.y=i.y+i.height/2,egret.Tween.get(this.scroller.viewport).to({scrollH:0},this.scroller.viewport.scrollH/.5),egret.Tween.get(this.img_role).wait(this.scroller.viewport.scrollH/.5).to({x:i.x+i.width/2},1e3).call(function(){e.img_Bg.touchEnabled=!0}),i.StartAni(1e3),egret.log("开始动画播放完成")},t.prototype.SetListScale=function(){.5==this.scroller.scaleX?(this.scroller.scaleX=1,this.scroller.scaleY=1):(this.scroller.scaleX=.5,this.scroller.scaleY=.5)},t}(eui.Component);__reflect(GameUI.prototype,"GameUI",["eui.UIComponent","egret.DisplayObject"]);var GenCells=function(){function e(){}return e.GetCells=function(){for(var t=[],i=[],n=Config.GetInstance().configs_map[1],r=15,l=n.size,o=0,a=0;r>a;a++){for(var s=[],h=0;l>h;h++){var c=new Cell;c.id=o,s.push(c),i.push(c),o++}t.push(s)}for(var a=0;r>a;a++)for(var h=0;l>h;h++){var c=t[a][h];c.upCell=0==a?null:t[a-1][h],null!=c.upCell&&(c.upWall.cell1Id=c.upCell.id,c.upWall.cell2Id=c.id,c.upCell.downWall=c.upCell.walls[1]=c.upWall),c.downCell=a==r-1?null:t[a+1][h],c.leftCell=0==h?null:t[a][h-1],null!=c.leftCell&&(c.leftWall.cell1Id=c.leftCell.id,c.leftWall.cell2Id=c.id,c.leftCell.rightWall=c.leftCell.walls[3]=c.leftWall),c.rightCell=h==l-1?null:t[a][h+1],c.nearCells=[c.upCell,c.downCell,c.leftCell,c.rightCell],c.walls=[c.upWall,c.downWall,c.leftWall,c.rightWall]}return e.SetCellDrop(i,n),e.SetWallOpen(i),i},e.SetWallSize=function(e){e.forEach(function(e){})},e.SetCellDrop=function(e,t){var i=Common.ParseField(t.drop_item),n=Common.ParseField(t.drop_num),r=[];n.forEach(function(e,t){for(var n=0;e>n;n++)r.push(i[t])}),r.sort(function(e,t){return Math.random()>.5?-1:1}),e.forEach(function(i,n,l){if(0!=i.id&&i.id!=l.length-1){var o=r.length,a=e.length-2;0!=o&&o/a>Math.random()?(i.item=r[0],r.splice(0,1)):i.isSpecial=t.special_chance/1e4>Math.random()}})},e.SetWallOpen=function(t){t[0].isSigned=!0;for(var i=[],n=[],r=0,l=t;r<l.length;r++){var o=l[r];n.push(o)}var a=t[0];for(n.splice(0,1),i.push(t[0]);n.length>0;){var s=[];if(s=e.GetDesignedCell(a),s.length>0){var h=Common.getRandomInt(1,s.length);e.GetSharedWall(a,s[h-1]).isOpen=!0,a=s[h-1],a.isSigned=!0,i.push(a),n.splice(n.indexOf(a),1)}else{var h=Common.getRandomInt(1,i.length);a=i[h-1]}}},e.GetDesignedCell=function(e){var t=[];return null==e.upCell||e.upCell.isSigned||t.push(e.upCell),null==e.downCell||e.downCell.isSigned||t.push(e.downCell),null==e.leftCell||e.leftCell.isSigned||t.push(e.leftCell),null==e.rightCell||e.rightCell.isSigned||t.push(e.rightCell),t},e.GetSharedWall=function(e,t){var i;return e.leftWall==t.rightWall?i=e.leftWall:e.rightWall==t.leftWall?i=e.rightWall:e.upWall==t.downWall?i=e.upWall:e.downWall==t.upWall&&(i=e.downWall),i},e}();__reflect(GenCells.prototype,"GenCells");var LightMask=function(e){function t(){var t=e.call(this)||this,i=t;return i.lightMatrix=new egret.Matrix,i.cirleLight=new egret.Shape,i.cirleLight.blendMode=egret.BlendMode.ERASE,i.addChild(i.cirleLight),t}return __extends(t,e),t.prototype.setLightPos=function(e,t){this.cirleLight.x=e,this.cirleLight.y=t},t.prototype.setMaskSize=function(e,t){this.graphics.clear(),this.graphics.beginFill(0,.7),this.graphics.drawRect(0,0,e,t),this.graphics.endFill()},t.prototype.setLightValue=function(e){this.lightMatrix.createGradientBox(2*e,2*e,0,-e,-e);var t=this.cirleLight;t.graphics.clear();var i=[16777215,13882323,8947848,0],n=[1,.9,.2,0],r=[0,50,180,255];t.graphics.beginGradientFill(egret.GradientType.RADIAL,i,n,r,this.lightMatrix),t.graphics.drawCircle(0,0,e),t.graphics.endFill()},t}(egret.Sprite);__reflect(LightMask.prototype,"LightMask");var ManageCells=function(e){function t(t){var i=e.call(this)||this;return i._index=0,i.cells=[],i.returnPath=[],i.returnCell=null,i.cells=t,i.SetCurrentCell(),i.col=i.currentCell.downCell.id-i.currentCell.id,i}return __extends(t,e),Object.defineProperty(t.prototype,"index",{get:function(){return this._index},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentCell",{get:function(){return this._currentCell},enumerable:!0,configurable:!0}),t.prototype.SetIndex=function(e,t){var i=Math.floor(e/WallRender.width),n=Math.floor(t/WallRender.height),r=n*this.col+i;this._index!=r&&(this._index=r,this.SetCurrentCell(),this.SetReturnPath())},t.prototype.SetCurrentCell=function(){var e=this;e._currentCell=e.cells[e.index],e._currentCell.isPassed=!0,e.dispatchEventWith("RefreshCurRender",!1,e.index)},t.prototype.SetReturnPath=function(){this.GetUnpassedCells(this.currentCell)>1&&(0==this.returnPath.length||this.returnPath.length>5)&&(this.returnPath=[],null!=this.returnCell&&this.returnCell.HideReturnSign(),this.returnCell=GameUI.manageRenders.currentBgRender,this.returnCell.SetReturnSign()),null!=this.returnCell&&(-1==this.returnPath.indexOf(this.index)?this.returnPath.push(this.index):this.returnPath.splice(-1,1))},t.prototype.GetUnpassedCells=function(e){var t=null!=e.downCell&&e.downWall.isOpen&&!e.downCell.isPassed?1:0;return t+=null!=e.upCell&&e.upWall.isOpen&&!e.upCell.isPassed?1:0,t+=null!=e.leftCell&&e.leftWall.isOpen&&!e.leftCell.isPassed?1:0,t+=null!=e.rightCell&&e.rightWall.isOpen&&!e.rightCell.isPassed?1:0},t}(eui.Component);__reflect(ManageCells.prototype,"ManageCells",["eui.UIComponent","egret.DisplayObject"]);var ManageRenders=function(e){function t(t,i){var n=e.call(this)||this;return n.wallList=t,n.cellList=i,GameUI.manageCells.addEventListener("RefreshCurRender",n.RefreshRender,n),n}return __extends(t,e),t.prototype.InitRenders=function(e){var t=this;t.wallList.dataProvider=new eui.ArrayCollection(GameUI.manageCells.cells),t.wallList.itemRenderer=WallRender,t.cellList.dataProvider=new eui.ArrayCollection(GameUI.manageCells.cells),t.cellList.itemRenderer=CellBgRender,t.wallList.validateNow(),t.wallList.validateDisplayList(),t.cellList.validateNow(),t.cellList.validateDisplayList(),t.RefreshRender(new egret.Event("",!1,!1,0))},t.prototype.RefreshRender=function(e){this.currentRender=this.wallList.getElementAt(e.data),this.currentBgRender=this.cellList.getElementAt(e.data),this.currentBgRender.LightenUp(),this.currentRender.LightingUp()},t}(eui.Component);__reflect(ManageRenders.prototype,"ManageRenders",["eui.UIComponent","egret.DisplayObject"]);var MyEvent=function(e){function t(t,i,n){return void 0===i&&(i=!1),void 0===n&&(n=!1),e.call(this,t,i,n)||this}return __extends(t,e),t.updateStepNum="updateStepNum",t.moveScroll="moveScroll",t}(egret.Event);__reflect(MyEvent.prototype,"MyEvent");var VirtualRocker=function(e){function t(){var t=e.call(this)||this;return t.circleRadius=0,t.ballRadius=0,t.centerX=0,t.centerY=0,t.p1=new egret.Point,t.p2=new egret.Point,t}return __extends(t,e),t.prototype.partAdded=function(t,i){e.prototype.partAdded.call(this,t,i)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.circleRadius=this.circle.height/2,this.ballRadius=this.ball.height/2,this.centerX=this.circleRadius,this.centerY=this.circleRadius,this.anchorOffsetX=this.circleRadius,this.anchorOffsetY=this.circleRadius,this.touchEnabled=!1},t.prototype.start=function(){this.visible=!0,this.ball.x=this.centerX,this.ball.y=this.centerY},t.prototype.stop=function(){this.visible=!1},t.prototype.onTouchMove=function(e){this.p1.x=this.x,this.p1.y=this.y,this.p2.x=e.stageX,this.p2.y=e.stageY;var t=egret.Point.distance(this.p1,this.p2),i=Math.atan2(e.stageY-this.y,e.stageX-this.x);return t<=this.circleRadius-this.ballRadius?(this.ball.x=this.centerX+e.stageX-this.x,this.ball.y=this.centerY+e.stageY-this.y):(this.ball.x=Math.cos(i)*(this.circleRadius-this.ballRadius)+this.centerX,this.ball.y=Math.sin(i)*(this.circleRadius-this.ballRadius)+this.centerY),i},t}(eui.Component);__reflect(VirtualRocker.prototype,"VirtualRocker",["eui.UIComponent","egret.DisplayObject"]);var Wall=function(){function e(){this.isOpen=!1,this.left=0,this.right=0,this.top=0,this.bottom=0}return e}();__reflect(Wall.prototype,"Wall");var WallRender=function(e){function t(){var t=e.call(this)||this;return t.isPassed=!1,t.addEventListener(egret.Event.ADDED,t.GetWallSize,t),t}return __extends(t,e),t.prototype.GetWallSize=function(){0==t.hWallHeight&&(t.hWallHeight=this.img_upWall.height),0==t.vWallwidth&&(t.vWallwidth=this.img_leftWall.width),0==t.height&&(t.height=this.height),0==t.width&&(t.width=this.width)},t.prototype.dataChanged=function(){var e=this.data;this.img_leftWall.visible=!e.leftWall.isOpen,this.img_upWall.visible=!e.upWall.isOpen,this.img_downWall.visible=!e.downWall.isOpen,this.img_rightWall.visible=!e.rightWall.isOpen,this.visible=0==e.id},t.prototype.LightingUp=function(){if(!this.isPassed){this.data;this.visible=!0,this.isPassed=!0}},t.prototype.SetWallSize=function(e){this.img_leftWall.top=e.leftWall.top*t.hWallHeight*.5,this.img_leftWall.bottom=e.leftWall.bottom*t.hWallHeight*.5,this.img_rightWall.top=e.rightWall.top*t.hWallHeight*.5,this.img_rightWall.bottom=e.rightWall.bottom*t.hWallHeight*.5,this.img_upWall.left=e.upWall.left*t.vWallwidth*.5,this.img_upWall.right=e.upWall.right*t.vWallwidth*.5,this.img_downWall.left=e.downWall.left*t.vWallwidth*.5,this.img_downWall.right=e.downWall.right*t.vWallwidth*.5},t.prototype.StartAni=function(e){var t=500;return egret.Tween.get(this.img_leftWall).wait(e).to({top:-2},t),t},t.hWallHeight=0,t.vWallwidth=0,t.height=0,t.width=0,t}(eui.ItemRenderer);__reflect(WallRender.prototype,"WallRender");var ItemManage=function(){function e(){this.data={}}return e.GetInstance=function(){return e.instance},e.prototype.GetItem=function(e,t){return void 0===t&&(t=1),__awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return this.data[e]?this.data[e]+=t:this.data[e]=t,[4,this.SaveData()];case 1:return i.sent(),[2]}})})},e.prototype.ComposeItem=function(e,t){var i=this;void 0===t&&(t=1);var n=Config.GetInstance().configs_item;if(""==n[e].need_item)return-2;var r=n[e].need_item.split(","),l=n[e].need_num.split(",");return r.forEach(function(e,t){var r=Number(e);return n[r]?i.data[r]<Number(l[t])?-1:void 0:-2}),r.forEach(function(e,t){i.GetItem(Number(e),-Number(l[t]))}),this.GetItem(e,t),1},e.prototype.LoadData=function(){this.data=Common.LoadData(data_key_item)},e.prototype.SaveData=function(){console.log(this.data),Common.SaveData(data_key_item,this.data)},e.instance=new e,e}();__reflect(ItemManage.prototype,"ItemManage",["PlayerData"]);var data_key_item="item";window.Main=Main;